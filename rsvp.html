
<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="robots" content="noindex">
    <meta name="googlebot" content="noindex">
    <title>UW FHIR Workshop</title>
    <link type="text/css" href="css/smoothness/jquery-ui-1.8.16.custom.css" rel="stylesheet" />  
    <link type="text/css" href="css/default.css?210129001" rel="stylesheet" />
    <link type="text/css" href="css/form.css?346530586" rel="stylesheet" />
  </head>
<body>
<div style="position:relative;height:650px;width:100%;">
<div class="center-form">
<br />
<center>
	<h1>UW FHIR Workshop</h1>
</center>

<form id="rsvpForm" name="rsvpForm" action="thankyou.php" method="post" style="display:none;">
<div id="lbl_name_first">First</div>
<div id="name_first"><input type="text" class="name_first" id="name_first_input" name="name_first" autofocus></div>

<div id="lbl_name_last">Last</div>
<div id="name_last"><input type="text" class="name_last" id="name_last_input" name="name_last"></div>

<div id="lbl_email">Email</div>
<div id="email"><input type="text" class="email" id="email_input" name="email"></div>

<div id="lbl_organization">Organization</div>
<div id="organization"><input type="text" class="organization" id="organization_input" name="organization"></div>

<div id="lbl_title">Title</div>
<div id="title"><input type="text" class="title" id="title_input" name="title"></div>


<div id="lbl_student">
  I am a student?
</div>
<div id="non_student"><input type="radio" id="studentno" name="student" value="no" onclick="calc_fee();" checked>No</div>
<div id="student"><input type="radio" id="studentyes" name="student" value="yes" onclick="calc_fee();">Yes</div>

<div id="lbl_empfac">
  I am a University employee or faculty?
</div>
<div id="non_empfac"><input type="radio" id="empfacno" name="empfac" value="no" onclick="calc_fee();" checked>No</div>
<div id="empfac"><input type="radio" id="empfacyes" name="empfac" value="yes" onclick="calc_fee();">Yes</div>

<div id="lbl_membership">
  <a href="http://hspconsortium.org/membership/member-list/" target="_blank">I or my organization has paid benefactor, associate, or individual membership dues to HSPC?</a>
</div>
<div id="non_member"><input type="radio" id="memberno" name="member" value="no" onclick="calc_fee();" checked>No</div>
<div id="member"><input type="radio" id="memberyes" name="member" value="yes" onclick="calc_fee();">Yes</div>


<div id="lbl_days_attending">
  Days you will attend?
</div>
<div id="all"><input type="checkbox" class="all" id="all_input" name="all" value="yes" onclick="all_conf();">
  Full Conference
</div>
<div id="lbl_individual_days">
  ...or individual days...
</div>
<div id="day1"><input type="checkbox" class="day1" id="day1_input" name="day1" value="yes" onclick="calc_fee();">
  Sep 23 
</div>
<div id="day2"><input type="checkbox" class="day2" id="day2_input" name="day2" value="yes" onclick="calc_fee();">
  Sep 24
</div>

<input type="hidden" id="member_val" name="member_val" value="">
<input type="hidden" id="all_val" name="all_val" value="">
<input type="hidden" id="day1_val" name="day1_val" value="">
<input type="hidden" id="day2_val" name="day2_val" value="">

<div id="lbl_fee_total">Registration fee total:</div>
<div id="fee_total">$0</div>
<input id="reg_fee_total" type="hidden" name="reg_fee_total">

<div id="lbl_fields_required">*You must complete all fields to RSVP</div>

<span id="continue_errors"></span>

<div id="continue_button">
  <button type="button" class="continue_button" id="continue" onclick="continue_clicked();">Continue to payment</button>
</div>


<div id="payment">
Secure Registration Payment <br /><br />

  <div class="form-row">
    <label>
      <span>Name on Card</span>
      <input type="text" size="25" data-stripe="name">
    </label>
  </div>

  <div class="form-row">
    <label>
      <span>Card Number</span>
      <input type="text" size="20" data-stripe="number">
    </label>
  </div>

  <div class="form-row">
    <label>
      <span>Expiration (MM/YY)</span>
      <input type="text" size="2" data-stripe="exp_month">
    </label>
    <span> / </span>
    <input type="text" size="2" data-stripe="exp_year">
  </div>

  <div class="form-row">
    <label>
      <span>CVC</span>
      <input type="text" size="4" data-stripe="cvc">
    </label>
  </div>

  <span id="payment_errors" class="payment-errors"></span>

  <div id="cancel_button">
    <button type="button" class="cancel_button" onclick="cancel_clicked();">Cancel</button>
  </div>

  <div id="submit_button">
    <button type="submit" class="submit" value="Submit">Submit RSVP & Payment</button>
  </div>
</div>
</form>

</div>
</div>

<script type="text/javascript" src="js/gen_validatorv4.js"></script>
<script type="text/javascript" src="js/jquery-1.6.2.min.js"></script>
<script type="text/javascript" src="js/jquery-ui-1.8.16.custom.min.js"></script>
<script type="text/javascript" src="https://js.stripe.com/v2/"></script>

<script type="text/javascript">
Stripe.setPublishableKey('pk_live_ecfXF97pISNCQozJ2zHjzWdt');
$(function() {
  var $form = $('#rsvpForm');
  $form.submit(function(event) {
    // Disable the submit button to prevent repeated clicks:
    $form.find('.submit').prop('disabled', true);

    // Request a token from Stripe:
    Stripe.card.createToken($form, stripeResponseHandler);

    // Prevent the form from being submitted:
    return false;
  });
});

function stripeResponseHandler(status, response) {
  // Grab the form:
  var $form = $('#rsvpForm');

  if (response.error) { // Problem!
    // Show the errors on the form:
    $form.find('.payment-errors').text(response.error.message);
    $form.find('.submit').prop('disabled', false); // Re-enable submission
  } else { // Token was created!
    // Get the token ID:
    var token = response.id;
    // Insert the token ID into the form so it gets submitted to the server:
    $form.append($('<input type="hidden" name="stripeToken">').val(token));
    // Submit the form:
    $form.get(0).submit();
  }
};
</script>

<script type="text/javascript">
var registration_fee = {
	day_1: { student: 15, empfac: 25, member: 50, non_member: 60 },
	day_2: { student: 25, empfac: 75, member: 100, non_member: 150 },
	all:   { student: 30, empfac: 100, member: 150, non_member: 200 }
};

var registration_total = 0;
var member_type = '';
var days_attending = '';

function calc_fee() {
  registration_total = 0;
  member_type = '';
  days_attending = '';

  if($('#studentyes').is(':checked')) { member_type = 'student'; }
  else if($('#empfacyes').is(':checked')) { member_type = 'empfac'; }
  else if($('#memberyes').is(':checked')) { member_type = 'member'; }
  else { member_type = 'non_member'; }

  if($('#all_input').is(':checked')) { days_attending = 'all'; }
  else if($('#day1_input').is(':checked') && $('#day2_input').is(':checked')) { days_attending = 'all'; }
  else if($('#day1_input').is(':checked')) { days_attending = 'day_1'; }
  else if($('#day2_input').is(':checked')) { days_attending = 'day_2'; }

  if(days_attending != '') {
    registration_total = registration_fee[days_attending][member_type];
  }

  $('#fee_total').text('$' + registration_total.toString());
};

function all_conf() {
  if($('#all_input').is(':checked')) {
    $('#day1_input').prop('checked', true);
    $('#day2_input').prop('checked', true);

    $('#day1_input').prop('disabled', true);
    $('#day2_input').prop('disabled', true);
  } else {
    $('#day1_input').prop('checked', false);
    $('#day2_input').prop('checked', false);

    $('#day1_input').removeProp('disabled');
    $('#day2_input').removeProp('disabled');
  }

  calc_fee();
};

function continue_clicked() {
  calc_fee();

  if($('#all_input').is(':checked')) { $('#all_val').val('yes'); } else { $('#all_val').val('no'); }
  if($('#day1_input').is(':checked')) { $('#day1_val').val('yes'); } else { $('#day1_val').val('no'); }
  if($('#day2_input').is(':checked')) { $('#day2_val').val('yes'); } else { $('#day2_val').val('no'); }

  $('#reg_fee_total').val(registration_total.toString());

  if(member_type == 'student') { $('#member_val').val('Student'); }
  else if(member_type == 'empfac') { $('#member_val').val('EmployeeOrFaculty'); }
  else if(member_type == 'member') { $('#member_val').val('HSPC Member'); }
  else if(member_type == 'non_member') { $('#member_val').val('Other'); }

  if(($('#name_first_input').val().length !== 0)&&
     ($('#name_last_input').val().length !== 0)&&
     ($('#email_input').val().length !== 0)&&
     ($('#organization_input').val().length !== 0)&&
     ($('#title_input').val().length !== 0)&&
     ($('#day1_input').is(':checked')||$('#day2_input').is(':checked')||$('#all_input').is(':checked'))&&
 (checkEmail($('#email_input').val()))) {
       $('#continue_errors').text('');
       $('#continue').prop('disabled',true);
       $('#payment').show();
       toggle_fields('off');
  } else {
    $('#continue_errors').show();
    $('#continue_errors').text('Required: All fields filled in... a valid email address... and at least one day selected!');
  }
};

function cancel_clicked() {
  $('#payment').hide();
  $('#continue_errors').text('');
  $('#continue_errors').show();
  $('#continue').removeProp('disabled');
  toggle_fields('on');
};

function toggle_fields(d) {
  if(d == 'off') {
    $('#name_first_input').prop('readonly', true);
    $('#name_last_input').prop('readonly', true);
    $('#email_input').prop('readonly', true);
    $('#organization_input').prop('readonly', true);
    $('#title_input').prop('readonly', true);
    $('#studentyes').prop('disabled', true);
    $('#studentno').prop('disabled', true);
    $('#empfacyes').prop('disabled', true);
    $('#empfacno').prop('disabled', true);
    $('#memberyes').prop('disabled', true);
    $('#memberno').prop('disabled', true);
    $('#day1_input').prop('disabled', true);
    $('#day2_input').prop('disabled', true);
    $('#all_input').prop('disabled', true);
  } else {
    $('#name_first_input').prop('readonly', false);
    $('#name_last_input').prop('readonly', false);
    $('#email_input').prop('readonly', false);
    $('#organization_input').prop('readonly', false);
    $('#title_input').prop('readonly', false);
    $('#studentyes').removeProp('disabled');
    $('#studentno').removeProp('disabled');
    $('#empfacyes').removeProp('disabled');
    $('#empfacno').removeProp('disabled');
    $('#memberyes').removeProp('disabled');
    $('#memberno').removeProp('disabled');
    $('#all_input').removeProp('disabled');

    if(!$('#all_input').is(':checked')) {
      $('#day1_input').removeProp('disabled');
      $('#day2_input').removeProp('disabled');
    }
  }
};

function checkEmail(emailAddress) {
  var sQtext = '[^\\x0d\\x22\\x5c\\x80-\\xff]';
  var sDtext = '[^\\x0d\\x5b-\\x5d\\x80-\\xff]';
  var sAtom = '[^\\x00-\\x20\\x22\\x28\\x29\\x2c\\x2e\\x3a-\\x3c\\x3e\\x40\\x5b-\\x5d\\x7f-\\xff]+';
  var sQuotedPair = '\\x5c[\\x00-\\x7f]';
  var sDomainLiteral = '\\x5b(' + sDtext + '|' + sQuotedPair + ')*\\x5d';
  var sQuotedString = '\\x22(' + sQtext + '|' + sQuotedPair + ')*\\x22';
  var sDomain_ref = sAtom;
  var sSubDomain = '(' + sDomain_ref + '|' + sDomainLiteral + ')';
  var sWord = '(' + sAtom + '|' + sQuotedString + ')';
  var sDomain = sSubDomain + '(\\x2e' + sSubDomain + ')*';
  var sLocalPart = sWord + '(\\x2e' + sWord + ')*';
  var sAddrSpec = sLocalPart + '\\x40' + sDomain; // complete RFC822 email address spec
  var sValidEmail = '^' + sAddrSpec + '$'; // as whole string

  var reValidEmail = new RegExp(sValidEmail);

  return reValidEmail.test(emailAddress);
};

</script>

<script type="text/javascript">if (window.Stripe) $("#rsvpForm").show()</script>
<noscript><center><p><h1>JavaScript is required for the RSVP form.</h1></p></center></noscript>
</body>
</html>
